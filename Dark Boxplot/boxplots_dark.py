#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Jul 30 16:32:40 2025

@author: @iddoamit
"""

import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit as cf
import os

here = os.path.dirname(os.path.realpath(__file__))+'/'

# =============================================================================
# Fitting equation
# =============================================================================
def H(x, K, b):
    return K/x+b

# =============================================================================
# Data
# =============================================================================
X = np.arange(1, 4.1, 0.5)
data = np.array([
[0.0007744833864011481, 0.0005093824357174054, 0.0004748681007857391,  0.00035764255313177994, 0.00025774048437530057, 0.00024282812860096145, 0.00018536736503667954],
[0.0007473032912468805, 0.0005574188530968678, 0.00032281081299297945, 0.0003152324147885127,  0.0003681899522518291,  0.00028473157280052726, 0.00020452717187144652],
[0.0008002779027400088, 0.0005923168203984814, 0.00032394895231064555, 0.0003556638347912004,  0.0003415741355236458,  0.0002719278478138743,  0.00012597942054612074],
[0.0008293051656974664, 0.0005500154109587104, 0.0004203914430796158,  0.00037072622296860396, 0.00022950130478365031, 0.0002130763708466881,  0.0002608652798422692],
[0.0008132392011953037, 0.0005082008378603528, 0.0005929021001106118,  0.0004264471423222676,  0.00031392176777615536, 0.0003077189852688896,  0.0002528485860683587],
[0.0007825597307185027, 0.0005892986624924855, 0.00043493576044271624, 0.0004674960879845198,  0.0002712274056843046,  0.0003023008843952821,  0.0001918401298337883],
[0.0007444128527108002, 0.0006339935611162658, 0.0005168918133510571,  0.0004330902228936182,  0.00030295814026615306, 0.00026956789200176137, 0.00028112572131749745],
[0.0008828603808427308, 0.0006045662218384559, 0.0004004483068676208,  0.0004472244949163444,  0.00038201081144126245, 0.00023742237459840695, 0.00021582205133060614],
[0.0006864187351167541, 0.0006064398861108983, 0.0004258293294377888,  0.00031825494566575856, 0.0002675537289718783,  0.00022214387267525555, 0.00028448217984111966],
[0.0008904333638900842, 0.000573037138805446,  0.00050007918302874,    0.00035554595570166724, 0.0002538034748865759,  0.00023014368405060748, 0.00017341641885627507],
[0.0007528012984778139, 0.0005251562504334054, 0.0005504267842397953,  0.00026916126134366776, 0.00019011114632940928, 0.00024451492967929604, 0.00018573795021462587],
[0.0008580035605297588, 0.0005263094423193328, 0.00041740377493510524, 0.0003472616624085508,  0.0002741551142908532,  0.00026225260390629176, 0.00018571343995357805],
[0.0008512895444900261, 0.0005507457211370566, 0.00043582071694661727, 0.00034287100017252954, 0.0002765973715993601,  0.0003178451951409087,  0.0002741048795542368],
[0.0007965119035485776, 0.0005410326756345033, 0.000416689605766912,   0.00044628329274369594, 0.0002540431863135886,  0.00022654305182514604, 0.00023647559609605556],
[0.0007980995677595703, 0.0005325620844254448, 0.000390683039394281,   0.00029562659672646924, 0.0002693218366759047,  0.00024516587227519266, 0.00027699077372504374]
])
 
means = np.mean(data, 0)
F0, G0 = cf(H, X, means, p0=(8e-4, 0))
qx = np.linspace(X[0], X[-1], 1001)


# =============================================================================
# Figure settings and colours
# =============================================================================
BackBlue = np.array([36., 36., 66.])/255
FontGrey = 0.85*np.array([1., 1., 1.])
HighlightOrange = np.array([240., 153., 66.])/255

mpl.rcParams['figure.figsize'] = list(np.array([8., 6.])/2.54)
mpl.rcParams['figure.dpi'] = 600
mpl.rcParams['figure.facecolor'] = BackBlue
mpl.rcParams['axes.facecolor'] = BackBlue
mpl.rcParams['axes.edgecolor'] = FontGrey
mpl.rcParams['axes.labelpad'] = 4.0
mpl.rcParams['axes.linewidth'] = 0.75
mpl.rcParams['font.family'] = 'serif'
mpl.rcParams['font.serif'] = 'Palatino'
mpl.rcParams['font.size'] = 8
mpl.rcParams['xtick.color'] = FontGrey
mpl.rcParams['ytick.color'] = (1, 1, 1)
mpl.rcParams['axes.labelcolor'] = FontGrey

# =============================================================================
# Figure components
# =============================================================================
fig, axs = plt.subplots(tight_layout=True)
axs.set_xlabel('Bias (V)')
axs.set_ylabel('Fall time (ms)')

for i in range(len(X)):
    axs.boxplot(1e3*data[:, i], positions=[X[i]], widths=[0.15], 
                showfliers=False, showmeans=False, 
                medianprops={'linewidth': 0.5, 'color': (1, 1, 1), 'linestyle': (0, (2, 1))}, 
                boxprops={'linewidth': 0.5, 'color': (1, 1, 1)}, 
                whiskerprops={'linewidth': 0.5, 'color': (1, 1, 1)}, 
                capprops={'linewidth': 0}, zorder=2)

axs.scatter(X, 1e3*means, marker='s', s=7, fc=HighlightOrange, ec=(0, 0, 0, 0), 
            label=r'$\langle\tau\rangle$', zorder=5)
axs.plot(qx, 1e3*H(qx, *F0), color=HighlightOrange, linewidth=0.5, linestyle=(0, (2, 2)), label=r'Fit: $\langle\tau\rangle$ = '+f'{1e3*F0[0]:.2f}/V+{1e3*F0[1]:.2f}', zorder=7)
axs.fill_between(qx, 1e3*H(qx, *(F0-np.sqrt(np.diag(G0)))), 1e3*H(qx, *(F0+np.sqrt(np.diag(G0)))), fc=(1, 1, 1, 0.25), label='Confidence intervals')

handles, labels = axs.get_legend_handles_labels()
Leg = axs.legend(handles, labels, frameon=False, loc='upper right', handlelength=1, fontsize=7, handletextpad=0.5, ncols=1)

fig.align_labels()
fig.savefig(here+'Dark_boxplot.png')
plt.show()
